<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../components/head'); %>

    <link href="/static/style/blog.css" rel="stylesheet" type="text/css" />
  </head>
  <body class="little-left-margin">
    <br>
    <a class="normal-link" href="<%= previousLink %>">‚Üê Back</a>

    <h1 class="title" style="margin-bottom: 0;"><%= blog.title %></h1>
    <span class="small"><%= blog.createdAt %> (<%= blog.viewCount %> views)</span>

    <div id="content">
      <%- blog.html_content %>
    </div>

    <%if (renderAnalytics == true) { %>
      <script src="/scripts/science.js"></script>

      <script>
        window.tracker = ackeeTracker.create(`https://<%= analytics.AckeeHost %>`, {
          ignoreLocalhost: true,
          detailed: true,
          ignoreOwnVisits: false
        })

        window.tracker.record('<%= analytics.AckeeID %>')
      </script>
    <% } %> 

    <%if (isPreviewMode == true) { %>
      <script>
        window.replaceState({}, `/blog/<%= blog.slug %>`)
      </script>
    <% } %>

    <script>
      document.addEventListener('click', function(e){
        if(e.target.tagName=="A" && e.target.className != "normal-link"){
          e.preventDefault()
          window.open(e.target.href, '_blank').focus();

          if(window.tracker){
            window.tracker.action('d8d5eb8e-d290-4c67-b4df-75d301073836', {
              key: 'Click',
              value: e.target.href
            })
          }
        }
      })

      fetch(`${location.href}/increase_counter`)
    </script>
  </body>
</html>